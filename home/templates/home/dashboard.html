{% extends "fantasyFootball/base.html" %} {% block page_content %}{% load static %}{% load tz %}
<link href="{% static 'home/dashboard.css' %}" rel="stylesheet">
<link href="{% static 'picks/css/picks.css' %}" rel="stylesheet">
<link href="{% static 'bets/css/bets.css' %}" rel="stylesheet">


<!-- Games and League Menu Navbar -->
<div class="navbar-dashboard shadow">
    <nav class="nav-fill w-100">
        <div class="nav main-nav" id="nav-tab" role="tablist">
            <a class="nav-item dashboard-menu-item nav-link  {% if lastAccessedPage == None or lastAccessedPage == 'League' %} active {% endif %}" id="nav-league-tab" data-toggle="tab" href="#nav-league" role="tab" aria-controls="nav-league" aria-selected="false">League</a>
            <a class="nav-item dashboard-menu-item nav-link {% if lastAccessedPage == 'Games' %} active {% endif %}" id="nav-games-tab" data-toggle="tab" href="#nav-games" role="tab" aria-controls="nav-games" aria-selected="true">Games</a>
            <a class="nav-item dashboard-menu-item nav-link {% if lastAccessedPage == 'My Picks' %} active {% endif %}" id="nav-picks-tab" data-toggle="tab" href="#nav-picks" role="tab" aria-controls="nav-picks" aria-selected="false">My Picks</a>
            <a class="nav-item dashboard-menu-item nav-link {% if lastAccessedPage == 'My Bets' %} active {% endif %}" id="nav-bets-tab" data-toggle="tab" href="#nav-bets" role="tab" aria-controls="nav-bets" aria-selected="false">My Bets</a>
        </div>
    </nav>
</div>
<div class="container-fluid">
    <div class="d-flex mt-2 mr-3 ml-3">
        <h2 class="w-100 text-center"><strong>{{ activeLeague }}</strong></h2>
        {% if weeks %}
        <div class="dropdown">
            <button class="btn week-pick dropdown-toggle" id="weekId" name="{{ week }}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><strong>Week {{ week }}</strong></button>
            <div class="dropdown-menu">
                {% for week in weeks %}
                <a class="dropdown-item" href="/home/{{ week }}/"><strong>{{ week }}</strong></a> {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    <div class="tab-content" id="nav-tabContent">
        <!-- League Home tab -->
        <div class="tab-pane fade rounded {% if lastAccessedPage == None or lastAccessedPage == 'League' %} active show {% endif %}" id="nav-league" role="tabpanel" aria-labelledby="nav-league-tab">
            <div class="row mb-3">
                <div class="col-xl-4 col-md-6 mt-3">
                    <div class="card-header collapse-col text-center">
                        <div class="d-flex justify-content-between">
                            <strong>Leaderboard</strong>
                            <i class="arrow"></i>
                        </div>
                    </div>
                    <div class="card shadow max-height-650">
                        <div class="leaderboard">
                            <table class="table text-center" cellspacing="0" width="100%">
                                <thead class="thead">
                                    <tr>
                                        <th scope="col">Position</th>
                                        <th scope="col">Player</th>
                                        <th scope="col">Score</th>
                                        <th scope="col">Week Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for currentUser in leagueUserData %}
                                    <tr>
                                        {% if forloop.counter == 1 %}
                                        <td><img class="" src="{% static 'media/gold.png' %}" width="auto" height="30"></td>
                                        {% elif forloop.counter == 2 %}
                                        <td><img class="" src="{% static 'media/silver.png' %}" width="auto" height="30"></td>
                                        {% elif forloop.counter == 3 %}
                                        <td><img class="" src="{% static 'media/bronze.png' %}" width="auto" height="30"></td>
                                        {% else %}
                                        <td>{{ forloop.counter }}</td>
                                        {% endif %}
                                        <td>{{ currentUser.username }}</td>
                                        <td>{{ currentUser.totalScore }}</td>
                                        {% if currentUser.weeklyGain > 0 %}
                                        <td class="text-success">+{{ currentUser.weeklyGain }}</td>
                                        {% elif currentUser.weeklyGain == 0 %}
                                        <td class="text">+{{ currentUser.weeklyGain }}</td>
                                        {% else %}
                                        <td class="text-danger">{{ currentUser.weeklyGain }}</td>
                                        {% endif %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-md-6 mt-3">
                    <div class="card-header collapse-col text-center">
                        <div class="d-flex justify-content-between">
                            <strong>League News</strong>
                            <i class="arrow"></i>
                        </div>
                    </div>
                    <div class="card shadow max-height-650">
                        <div class="news-board">
                            {% localtime off %} {% for currentNotification in leagueNotifications %}
                            <div class="m-3 p-1 media text-muted notification-box rounded">
                                <p class="media-body pb-2 mb-0 lh-125 text-white">
                                    <small>{{ currentNotification.createDate }}</small><strong class="d-block">{{ currentNotification.message }}</strong>
                                </p>
                            </div>
                            {% endfor %} {% endlocaltime %}
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 mt-3">
                    <div class="card-header collapse-col text-center">
                        <div class="d-flex justify-content-between">
                            <strong>Message Board</strong>
                            <i class="arrow"></i>
                        </div>
                    </div>
                    <div class="card shadow max-height-650">
                        <!-- LEAGUE MESSAGE LOGIC HERE -->
                        <div class="message-board">
                            {% localtime off %} {% if leagueMessages %} {% for currentMessage in leagueMessages %}
                            <div class="media text-muted pl-3 pr-3 pt-3">
                                <p class="media-body border-bottom border-gray">
                                    <strong class="d-block">@{{ currentMessage.username }} <small class="d-block">{{ currentMessage.createDate }}</small> </strong>{{ currentMessage.message }}
                                </p>
                            </div>
                            {% endfor %} {% else %}
                            <div class="media text-muted pt-3 text-center">
                                <p class="media-body">
                                    <strong class="d-block">No messages yet..</strong>
                                </p>
                            </div>
                            {% endif %} {% endlocaltime %}
                            <div class="media text-muted">
                                <p class="media-body text-center">
                                    <strong class="d-block">Please reload the page to see new messages.</strong>
                                </p>
                            </div>
                        </div>
                        <div class="input-group mt-auto p-2">
                            {% csrf_token %}
                            <input type="text" class="form-control rounded" id="messageBox" placeholder="Type Message.." aria-label="Message" aria-describedby="MaterialButton-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-md btn-secondary post-button" type="submit" id="MaterialButton-addon2">Post</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col text-center">
                    <div class="chart-container">
                        <canvas id="pointsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <!-- Game Summary tab -->
        <div class="tab-pane fade  {% if lastAccessedPage == 'Games' %} active show {% endif %}" id="nav-games" role="tabpanel" aria-labelledby="nav-games-tab">
            {% if gameData %}
            <div class="row no-gutters">
                <div class="col-6 text-center align-middle">
                    <h5><strong>Game</strong></h5>
                </div>
                <div class="col-3 text-center align-middle">
                    <h5><strong>Pick</strong></h5>
                </div>
                <div class="col-3 text-center align-middle">
                    <h5><strong>Bet</strong></h5>
                </div>
            </div>
            {% for currentGame in gameData %}
            <div class="row text-center border-bottom border-gray no-gutters mt-2" id="{{ currentGame.game.id }}">
                <div class="col-6 text-center">
                    <div class="d-flex justify-content-around align-items-center mb-2">
                        <div class="col-5">
                            <img class="" src="/static/media/{{ currentGame.game.awayTeam.name }}.png" width="50" height="50"> {% if currentGame.game.awayScore %} {% if currentGame.game.winner == currentGame.game.awayTeam %}
                            <h6><strong class="text-success">{{ currentGame.game.awayScore }}</strong></h6> {% else %}
                            <h6><strong class="text-danger">{{ currentGame.game.awayScore }}</strong></h6> {% endif %} {% else %}
                            <h5>-</h5>{% endif %}
                            <h6><small>({{ currentGame.game.awayTeam.wins }} - {{ currentGame.game.awayTeam.losses }} {% if currentGame.game.homeTeam.ties > 0 %} - {{ currentGame.game.homeTeam.ties }} {% endif %})</small></h6>
                        </div>
                        <div class="col-2">
                            <h4>@</h4>
                        </div>
                        <div class="col-5">
                            <img class="" src="/static/media/{{ currentGame.game.homeTeam.name }}.png" width="50" height="50"> {% if currentGame.game.homeScore %} {% if currentGame.game.winner == currentGame.game.homeTeam %}
                            <h6><strong class="text-success">{{ currentGame.game.homeScore }}</strong></h6> {% else %}
                            <h6><strong class="text-danger">{{ currentGame.game.homeScore }}</strong></h6> {% endif %} {% else %}
                            <h5>-</h5>{% endif %}
                            <h6><small>({{ currentGame.game.homeTeam.wins }} - {{ currentGame.game.homeTeam.losses }} {% if currentGame.game.awayTeam.ties > 0 %} - {{ currentGame.game.awayTeam.ties }} {% endif %})</small></h6>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <h6 class="mr-2"><small>{{ currentGame.date }}</small></h6>
                        <h6><small>{{ currentGame.time }}</small></h6>
                    </div>
                </div>
                <div class="col-3 text-center pick">
                    {% if currentGame.game.homeScore %} {% if currentGame.gameChoice.pickWinner %} {% if currentGame.gameChoice.correctPickFlag == True %}
                    <img src="/static/media/{{ currentGame.gameChoice.pickWinner.name }}.png" width="50" height="50"> {% if week == 1 or week == '1' %}
                    <h6 class="text-success"><strong>+50</strong></h6>
                    {% else %}
                    <h6 class="text-success"><strong>+25</strong></h6>
                    {% endif %} {% else %}
                    <img src="/static/media/{{ currentGame.gameChoice.pickWinner.name }}.png" width="50" height="50">
                    <h6 class="text-danger"><strong>+0</strong></h6>
                    {% endif %} {% else %}
                    <h6>No Pick</h6>
                    <h6 class="text-danger"><strong>+0</strong></h6>
                    {% endif %} {% else %} {% if currentGame.gameChoice.pickWinner %}
                    <img class="" src="/static/media/{{ currentGame.gameChoice.pickWinner.name }}.png" width="50" height="50">{% endif %} {% endif %}
                </div>
                <div class="col-3 text-center bet">
                    {% if currentGame.game.homeScore %} {% if currentGame.gameChoice.betWinner %} {% if currentGame.gameChoice.correctBetFlag == True %}
                    <img src="/static/media/{{ currentGame.gameChoice.betWinner.name }}.png" width="50" height="50">
                    <h6 class="text-success"><strong>+{{ currentGame.gameChoice.amountWon }}</strong></h6>
                    {% else %}
                    <img src="/static/media/{{ currentGame.gameChoice.betWinner.name }}.png" width="50" height="50">
                    <h6 class="text-danger"><strong>{{ currentGame.gameChoice.amountWon }}</strong></h6>
                    {% endif %} {% if currentGame.gameChoice.betWinner == currentGame.game.homeTeam %}
                    <h6>({{ currentGame.game.homeSpread|floatformat }}) {{ currentGame.gameChoice.betAmount }}</h6>
                    {% else %}
                    <h6>({{ currentGame.game.awaySpread|floatformat }}) {{ currentGame.gameChoice.betAmount }}</h6>
                    {% endif %} {% endif %} {% else %} {% if currentGame.gameChoice.betWinner %}
                    <img src="/static/media/{{ currentGame.gameChoice.betWinner.name }}.png" width="50" height="50"> {% if currentGame.gameChoice.betWinner == currentGame.game.homeTeam %}
                    <h6>({{ currentGame.game.homeSpread|floatformat }}) {{ currentGame.gameChoice.betAmount }}</h6>
                    {% else %}
                    <h6>({{ currentGame.game.awaySpread|floatformat }}) {{ currentGame.gameChoice.betAmount }}</h6>
                    {% endif %} {% endif %} {% endif %}
                </div>
            </div>
            {% endfor %} {% else %}
            <div class="row">
                <div class="col text-center">
                    <h5>This week's games have not yet been entered.</h5>
                </div>
            </div>
            {% endif %}
        </div>
        <!-- Picks tab -->
        <div class="tab-pane fade rounded m-1 {% if lastAccessedPage == 'My Picks' %} active show {% endif %}" id="nav-picks" role="tabpanel" aria-labelledby="nav-picks-tab">
            {% include "picks/picks.html" %}
        </div>
        <!-- Bets tab -->
        <div class="tab-pane fade rounded m-1 {% if lastAccessedPage == 'My Bets' %} active show {% endif %}" id="nav-bets" role="tabpanel" aria-labelledby="nav-bets-tab">
            {% include "bets/bets.html" %}
        </div>
    </div>
</div>
</div>
<script src="{% static 'home/js/dashboard.js' %}"></script>
<script src="{% static 'picks/js/picks.js' %}"></script>
<script src="{% static 'bets/js/betting.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
{{ leagueUserData|json_script:"leagueUserData" }}
<script>
    const pointsData = JSON.parse(document.getElementById('leagueUserData').textContent);

    var ctx = document.getElementById('pointsChart').getContext('2d');
    var userData = []
    pointsData.forEach((item) => {
        var randomColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
        userData.push({
            label: item.username,
            borderColor: randomColor,
            backgroundColor: randomColor,
            data: item.weeklyScores
        })
    });
    Chart.defaults.global.elements.line.fill = false;
    Chart.defaults.global.elements.line.tension = 0;

    var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {
            labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17'],
            datasets: userData
        },

        // Configuration options go here
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Points by Week'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Week'
                    },
                    gridLines: {
                        display: false,
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Points'
                    },
                    gridLines: {
                        display: false,
                    }
                }]
            }
        }
    });
</script>
{% endblock %}